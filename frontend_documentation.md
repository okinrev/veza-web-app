# ðŸ“– Documentation ComplÃ¨te du Frontend Talas

## Table des matiÃ¨res
1. [Architecture GÃ©nÃ©rale](#architecture-gÃ©nÃ©rale)
2. [Technologies UtilisÃ©es](#technologies-utilisÃ©es)
3. [Structure des Fichiers](#structure-des-fichiers)
4. [Pages Principales](#pages-principales)
5. [Composants JavaScript/Alpine.js](#composants-javascriptalpinejs)
6. [API Routes et RequÃªtes](#api-routes-et-requÃªtes)
7. [Gestion de l'Ã‰tat](#gestion-de-lÃ©tat)
8. [WebSocket et Communication Temps RÃ©el](#websocket-et-communication-temps-rÃ©el)

---

## 1. Architecture GÃ©nÃ©rale

Le frontend de Talas suit une architecture **modulaire et lÃ©gÃ¨re** basÃ©e sur :
- HTML statique pour la structure
- Alpine.js pour la rÃ©activitÃ© et gestion d'Ã©tat local
- Tailwind CSS pour le styling
- JavaScript natif pour les fonctionnalitÃ©s complexes
- WebSocket pour la communication temps rÃ©el

### Principes directeurs :
- **Pas de build process** : Tout fonctionne directement dans le navigateur
- **Progressive Enhancement** : Le site fonctionne sans JavaScript (forme basique)
- **Ã‰tat local** : Chaque page gÃ¨re son propre Ã©tat via Alpine.js
- **API REST** : Communication avec le backend Go via fetch API

---

## 2. Technologies UtilisÃ©es

| Technologie | Version | Usage |
|------------|---------|--------|
| Alpine.js | 3.x | RÃ©activitÃ©, gestion d'Ã©tat local |
| Tailwind CSS | CDN | Styling utility-first |
| JavaScript | ES6+ | Logique mÃ©tier, WebSocket |
| HTML5 | - | Structure des pages |
| LocalStorage | - | Persistance JWT, prÃ©fÃ©rences |

---

## 3. Structure des Fichiers

```
frontend/
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css          # Styles personnalisÃ©s
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ app.js            # Logique principale (main.html)
â”‚   â”œâ”€â”€ chat.js           # Gestion du chat unifiÃ©
â”‚   â”œâ”€â”€ message.js        # Messages directs
â”‚   â”œâ”€â”€ produits.js       # Gestion des produits
â”‚   â”œâ”€â”€ register.js       # Inscription
â”‚   â”œâ”€â”€ room.js           # Chat rooms
â”‚   â””â”€â”€ users.js          # Gestion utilisateurs
â”œâ”€â”€ pages principales/
â”‚   â”œâ”€â”€ login.html        # Page de connexion
â”‚   â”œâ”€â”€ register.html     # Page d'inscription
â”‚   â”œâ”€â”€ dashboard.html    # Tableau de bord dev
â”‚   â”œâ”€â”€ main.html         # Application principale
â”‚   â”œâ”€â”€ hub.html          # Hub intÃ©grÃ© (ancien)
â”‚   â”œâ”€â”€ hub_v2.html       # Hub v2 amÃ©liorÃ©
â”‚   â”œâ”€â”€ gg.html           # Version tout-en-un
â”‚   â”œâ”€â”€ chat.html         # Chat unifiÃ© (rooms + DM)
â”‚   â”œâ”€â”€ room.html         # Chat rooms dÃ©diÃ©
â”‚   â”œâ”€â”€ message.html      # Messages directs
â”‚   â”œâ”€â”€ users.html        # Liste utilisateurs
â”‚   â”œâ”€â”€ produits.html     # Gestion produits
â”‚   â”œâ”€â”€ user_products.html # Produits utilisateur
â”‚   â”œâ”€â”€ admin_products.html # Admin produits
â”‚   â”œâ”€â”€ track.html        # Gestion pistes audio
â”‚   â”œâ”€â”€ shared_ressources.html # Ressources partagÃ©es
â”‚   â”œâ”€â”€ api.html          # Documentation API
â”‚   â””â”€â”€ test.html         # Console de test API
â””â”€â”€ components/           # Composants rÃ©utilisables

```

---

## 4. Pages Principales

### 4.1 Page de Connexion (`login.html`)

**FonctionnalitÃ©s :**
- Formulaire de connexion avec email/mot de passe
- Validation cÃ´tÃ© client avec Alpine.js
- Gestion des erreurs et messages de succÃ¨s
- Redirection aprÃ¨s connexion rÃ©ussie
- Liens vers inscription et rÃ©cupÃ©ration de mot de passe

**Ã‰tat Alpine.js :**
```javascript
{
    email: '',
    password: '',
    message: '',
    messageType: 'error',
    isLoading: false,
    isLoggedIn: false
}
```

**Routes API utilisÃ©es :**
- `POST /login` - Authentification utilisateur

**LocalStorage :**
- `access_token` - Token JWT d'accÃ¨s
- `refresh_token` - Token de rafraÃ®chissement
- `user_id` - ID de l'utilisateur connectÃ©

---

### 4.2 Page d'Inscription (`register.html`)

**FonctionnalitÃ©s :**
- Formulaire complet avec validation en temps rÃ©el
- Indicateur de force du mot de passe
- VÃ©rification de la correspondance des mots de passe
- Acceptation des conditions d'utilisation
- Auto-connexion aprÃ¨s inscription rÃ©ussie

**Ã‰tat Alpine.js :**
```javascript
{
    form: {
        email: '',
        username: '',
        password: '',
        confirmPassword: '',
        acceptTerms: false
    },
    errors: {},
    passwordStrength: {
        score: 0,
        label: '',
        color: '',
        percent: 0
    },
    isLoading: false,
    registrationSuccess: false,
    message: { text: '', type: 'error' }
}
```

**MÃ©thodes principales :**
- `validateEmail()` - Validation format email
- `validateUsername()` - Validation nom d'utilisateur
- `checkPasswordStrength()` - Calcul force mot de passe
- `register()` - Soumission du formulaire

**Routes API :**
- `POST /signup` - CrÃ©ation de compte

---

### 4.3 Dashboard de DÃ©veloppement (`dashboard.html`)

**Description :**
Page de test permettant de visualiser plusieurs composants simultanÃ©ment via des iframes.

**Composants affichÃ©s :**
- Login
- Register
- Produits
- Salons
- Messages directs
- Liste utilisateurs
- Console API de test

---

### 4.4 Application Principale (`main.html`)

**Architecture :**
- Layout avec sidebar de navigation
- Chargement dynamique des composants
- Gestion des onglets avec Alpine.js

**Navigation disponible :**
```javascript
{
    'dashboard': 'Dashboard',
    'dm': 'Messages PrivÃ©s',
    'rooms': 'Salons',
    'tracks': 'Musiques',
    'products': 'Produits',
    'docs': 'Docs Produits',
    'shared': 'Ressources PartagÃ©es',
    'tags': 'Tags',
    'suggestions': 'Suggestions'
}
```

**Fonction de chargement dynamique :**
```javascript
loadComponent(id, url) {
    // Charge le HTML du composant dans le conteneur
}
```

---

### 4.5 Chat UnifiÃ© (`chat.html`)

**FonctionnalitÃ©s principales :**
- Interface Ã  deux onglets : Salons et Messages Directs
- WebSocket pour communication temps rÃ©el
- Gestion des notifications navigateur
- Indicateurs de prÃ©sence en ligne
- Historique des messages avec pagination
- CrÃ©ation de salons
- Recherche d'utilisateurs

**Ã‰tat complexe :**
```javascript
{
    // Authentification
    username: '',
    myUserId: null,
    isConnected: false,
    
    // Navigation
    activeTab: 'rooms',
    
    // Rooms
    rooms: [],
    currentRoom: '',
    roomMessages: [],
    newRoomName: '',
    
    // DM
    users: [],
    onlineUsers: [],
    otherUserId: null,
    otherUserInfo: {},
    messages: [],
    conversations: [],
    
    // UI States
    loadingMessages: false,
    sending: false,
    creating: false,
    notificationsEnabled: true,
    
    // WebSocket
    socket: null,
    reconnectAttempts: 0,
    maxReconnectAttempts: 5
}
```

**Protocole WebSocket :**
```javascript
// Envoi
{ type: "join", room: "general" }
{ type: "message", room: "general", content: "Hello" }
{ type: "dm", to: userId, content: "Hi!" }
{ type: "room_history", room: "general", limit: 50 }
{ type: "dm_history", with: userId, limit: 50 }

// RÃ©ception
{ type: "message", data: { room, username, content, timestamp } }
{ type: "dm", data: { fromUser, to, content, timestamp } }
{ type: "room_history", messages: [...] }
{ type: "user_joined", userId, username }
{ type: "user_left", userId }
{ type: "user_status", userId, isOnline }
```

---

### 4.6 Gestion des Produits (`produits.html`, `user_products.html`, `admin_products.html`)

**FonctionnalitÃ©s communes :**
- CRUD complet (Create, Read, Update, Delete)
- Upload de fichiers (images, PDF)
- Recherche et filtrage
- Pagination
- Tri par colonnes

**Ã‰tat produit :**
```javascript
{
    produits: [],
    filteredProduits: [],
    searchQuery: '',
    sortField: 'nom',
    sortDirection: 'asc',
    currentPage: 1,
    itemsPerPage: 10,
    
    form: {
        id: null,
        nom: '',
        description: '',
        prix: 0,
        stock: 0,
        fichiers: []
    },
    
    isEditing: false,
    isLoading: false,
    showDeleteModal: false,
    productToDelete: null
}
```

**Routes API produits :**
- `GET /products` - Liste des produits
- `POST /products` - CrÃ©er un produit
- `PUT /products/:id` - Modifier un produit
- `DELETE /products/:id` - Supprimer un produit
- `POST /products/:id/files` - Upload fichiers

**DiffÃ©rences entre versions :**
- `produits.html` : Version basique
- `user_products.html` : Vue utilisateur avec ses propres produits
- `admin_products.html` : Interface admin avec statistiques

---

### 4.7 Gestion des Pistes Audio (`track.html`)

**FonctionnalitÃ©s :**
- Liste des pistes avec mÃ©tadonnÃ©es
- Lecteur audio intÃ©grÃ©
- Upload de fichiers audio
- Gestion des tags et genres
- Partage communautaire
- Statistiques d'Ã©coute

**Ã‰tat Alpine.js :**
```javascript
{
    tracks: [],
    currentTrack: null,
    isPlaying: false,
    audioPlayer: null,
    
    filters: {
        genre: '',
        artist: '',
        tags: []
    },
    
    uploadForm: {
        title: '',
        artist: '',
        album: '',
        genre: '',
        tags: '',
        audioFile: null,
        coverFile: null
    },
    
    stats: {
        totalTracks: 0,
        totalPlays: 0,
        totalDuration: 0
    }
}
```

**MÃ©thodes audio :**
- `playTrack(track)` - Lecture d'une piste
- `pauseTrack()` - Pause
- `seekTo(position)` - Navigation dans la piste
- `updateVolume(level)` - ContrÃ´le du volume

---

### 4.8 Ressources PartagÃ©es (`shared_ressources.html`)

**Types de ressources :**
- Samples audio
- Presets
- Templates
- Documents
- Tutoriels

**FonctionnalitÃ©s :**
- Upload avec drag & drop
- CatÃ©gorisation par tags
- SystÃ¨me de notation
- Commentaires
- TÃ©lÃ©chargement avec compteur

**Ã‰tat :**
```javascript
{
    resources: [],
    categories: ['samples', 'presets', 'templates', 'docs', 'tutorials'],
    
    filters: {
        category: '',
        tags: [],
        rating: 0,
        uploader: ''
    },
    
    uploadForm: {
        title: '',
        description: '',
        category: '',
        tags: '',
        file: null
    },
    
    view: 'grid', // 'grid' ou 'list'
    sortBy: 'date', // 'date', 'rating', 'downloads'
}
```

---

### 4.9 Console de Test API (`test.html`)

**FonctionnalitÃ©s :**
- Interface pour tester tous les endpoints
- Historique des requÃªtes
- Sauvegarde des requÃªtes favorites
- Affichage formatÃ© des rÃ©ponses JSON
- Gestion des headers personnalisÃ©s

**Structure de requÃªte :**
```javascript
{
    method: 'GET',
    endpoint: '/api/v1/users',
    headers: {
        'Authorization': 'Bearer [token]',
        'Content-Type': 'application/json'
    },
    body: '',
    response: null,
    status: null,
    duration: 0
}
```

---

## 5. Composants JavaScript/Alpine.js

### 5.1 Patterns Communs

**Initialisation :**
```javascript
x-data="componentName()" 
x-init="init()"
```

**Gestion des erreurs :**
```javascript
try {
    const response = await fetch(url, options);
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response.json();
    // Traitement...
} catch (error) {
    this.showNotification('Erreur: ' + error.message, 'error');
}
```

**Notifications :**
```javascript
showNotification(message, type = 'info') {
    const notification = { id: Date.now(), message, type, show: true };
    this.notifications.push(notification);
    
    setTimeout(() => {
        notification.show = false;
        setTimeout(() => {
            this.notifications = this.notifications.filter(n => n.id !== notification.id);
        }, 300);
    }, 3000);
}
```

### 5.2 Gestion de l'authentification

**VÃ©rification du token :**
```javascript
async checkAuth() {
    const token = localStorage.getItem('access_token');
    if (!token) {
        window.location.href = '/login.html';
        return false;
    }
    
    try {
        const response = await fetch('/api/v1/users/me', {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (!response.ok) {
            throw new Error('Token invalide');
        }
        
        const user = await response.json();
        this.username = user.data.username;
        this.myUserId = user.data.id;
        return true;
    } catch (error) {
        localStorage.removeItem('access_token');
        window.location.href = '/login.html';
        return false;
    }
}
```

**DÃ©connexion :**
```javascript
logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    localStorage.removeItem('user_id');
    
    if (this.socket) {
        this.socket.close();
    }
    
    window.location.href = '/login.html';
}
```

---

## 6. API Routes et RequÃªtes

### 6.1 Configuration des requÃªtes

**Headers par dÃ©faut :**
```javascript
const defaultHeaders = {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
};
```

### 6.2 Endpoints principaux

| Domaine | MÃ©thode | Endpoint | Description |
|---------|---------|----------|-------------|
| **Auth** | POST | `/login` | Connexion |
| | POST | `/signup` | Inscription |
| | POST | `/logout` | DÃ©connexion |
| | POST | `/refresh` | RafraÃ®chir token |
| **Users** | GET | `/users/me` | Profil actuel |
| | GET | `/users` | Liste utilisateurs |
| | GET | `/users/except-me` | Utilisateurs sauf moi |
| | GET | `/users/search?q=` | Recherche |
| | PUT | `/users/me` | Modifier profil |
| **Products** | GET | `/products` | Liste produits |
| | POST | `/products` | CrÃ©er produit |
| | PUT | `/products/:id` | Modifier |
| | DELETE | `/products/:id` | Supprimer |
| **Chat** | WS | `/ws` | WebSocket chat |
| | GET | `/chat/rooms` | Liste salons |
| | POST | `/chat/rooms` | CrÃ©er salon |
| **Messages** | GET | `/chat/dm/:userId` | Historique DM |
| | GET | `/chat/rooms/:room/messages` | Messages salon |
| **Tracks** | GET | `/tracks` | Liste pistes |
| | POST | `/tracks` | Upload piste |
| | GET | `/tracks/:id/stream` | Stream audio |
| **Resources** | GET | `/resources` | Liste ressources |
| | POST | `/resources` | Upload ressource |
| | GET | `/resources/:id/download` | TÃ©lÃ©charger |

### 6.3 Gestion des erreurs HTTP

```javascript
async handleApiCall(url, options = {}) {
    try {
        const response = await fetch(url, {
            ...options,
            headers: {
                ...defaultHeaders,
                ...options.headers
            }
        });
        
        if (response.status === 401) {
            // Token expirÃ©, tentative de refresh
            await this.refreshToken();
            return this.handleApiCall(url, options);
        }
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.message || `HTTP ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('API Error:', error);
        throw error;
    }
}
```

---

## 7. Gestion de l'Ã‰tat

### 7.1 Ã‰tat Local (Alpine.js)

Chaque page gÃ¨re son propre Ã©tat via `x-data`. Les donnÃ©es ne persistent pas entre les pages sauf via :
- LocalStorage
- SessionStorage
- ParamÃ¨tres URL
- Cookies

### 7.2 Patterns de rÃ©activitÃ©

**Computed properties :**
```javascript
get filteredItems() {
    return this.items.filter(item => 
        item.name.toLowerCase().includes(this.searchQuery.toLowerCase())
    );
}
```

**Watchers :**
```javascript
x-init="
    $watch('searchQuery', value => {
        this.currentPage = 1;
        this.filterItems();
    })
"
```

### 7.3 Stores Alpine.js

Pour les donnÃ©es partagÃ©es (utilisÃ©es dans `gg.html`) :

```javascript
Alpine.store('app', {
    isLoggedIn: false,
    username: '',
    currentTab: 'auth',
    message: '',
    messageType: '',
    
    showMessage(msg, type = 'info') {
        this.message = msg;
        this.messageType = type;
        setTimeout(() => {
            this.message = '';
        }, 3000);
    }
});
```

---

## 8. WebSocket et Communication Temps RÃ©el

### 8.1 Connexion WebSocket

```javascript
connectWebSocket() {
    const token = localStorage.getItem('access_token');
    const wsUrl = `ws://localhost:8080/ws?token=${token}`;
    
    this.socket = new WebSocket(wsUrl);
    
    this.socket.onopen = () => {
        console.log('WebSocket connectÃ©');
        this.isConnected = true;
        this.reconnectAttempts = 0;
    };
    
    this.socket.onclose = () => {
        this.isConnected = false;
        this.handleReconnect();
    };
    
    this.socket.onerror = (error) => {
        console.error('WebSocket error:', error);
    };
    
    this.socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        this.handleWebSocketMessage(data);
    };
}
```

### 8.2 Reconnexion automatique

```javascript
handleReconnect() {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
        this.reconnectAttempts++;
        const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);
        
        console.log(`Reconnexion dans ${delay/1000}s...`);
        
        setTimeout(() => {
            this.connectWebSocket();
        }, delay);
    } else {
        this.showNotification('Connexion perdue. Veuillez rafraÃ®chir la page.', 'error');
    }
}
```

### 8.3 Gestion des messages

```javascript
handleWebSocketMessage(data) {
    switch(data.type) {
        case 'message':
            this.handleChatMessage(data);
            break;
        case 'dm':
            this.handleDirectMessage(data);
            break;
        case 'user_joined':
            this.handleUserJoined(data);
            break;
        case 'user_left':
            this.handleUserLeft(data);
            break;
        case 'typing':
            this.handleTypingIndicator(data);
            break;
        case 'error':
            this.showNotification(data.message, 'error');
            break;
        default:
            console.warn('Type de message inconnu:', data.type);
    }
}
```

---

## 9. Optimisations et Bonnes Pratiques

### 9.1 Performance

- **Lazy loading** : Chargement des composants Ã  la demande
- **Debouncing** : Pour les recherches et validations
- **Virtualisation** : Pour les longues listes (non implÃ©mentÃ© actuellement)
- **Pagination** : Limiter le nombre d'Ã©lÃ©ments affichÃ©s

### 9.2 SÃ©curitÃ©

- **Validation cÃ´tÃ© client** : PremiÃ¨re barriÃ¨re
- **Ã‰chappement HTML** : Protection XSS via Alpine.js
- **HTTPS** : Pour production
- **Token rotation** : Refresh tokens

### 9.3 AccessibilitÃ©

- **Labels ARIA** : Pour les lecteurs d'Ã©cran
- **Navigation clavier** : Support complet
- **Contraste** : Respect des standards WCAG
- **Messages d'erreur** : Clairs et informatifs

### 9.4 Responsive Design

- **Mobile-first** : Conception adaptative
- **Breakpoints Tailwind** : sm, md, lg, xl, 2xl
- **Touch-friendly** : Zones de clic suffisantes
- **Orientation** : Support portrait/paysage

---

## 10. Ã‰volution Future

### Versions planifiÃ©es :

**V4 - Streaming Audio**
- IntÃ©gration lecteur audio avancÃ©
- Playlists collaboratives
- Synchronisation multi-utilisateurs

**V5 - Partage Fichiers AvancÃ©**
- Versioning des fichiers
- Collaboration temps rÃ©el
- PrÃ©visualisation avancÃ©e

**V6 - Marketplace/Troc**
- SystÃ¨me d'enchÃ¨res
- RÃ©putation utilisateurs
- Paiements intÃ©grÃ©s

**V7 - AudioGridder**
- Interface de contrÃ´le VST
- Routing audio distant
- Sessions collaboratives

**V8-V12**
- Formation/tutoriels
- Radio communautaire
- Suivi produits/garanties
- Recherche globale
- Application Tauri

Cette documentation sera mise Ã  jour au fur et Ã  mesure de l'Ã©volution du projet.
