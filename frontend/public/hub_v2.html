<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∂ Talas ‚Äî Plateforme Musicale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        [x-cloak] { display: none !important; }
        
        /* Animations personnalis√©es */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Style pour le code */
        .code-block {
            @apply bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        /* Gradient de fond */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Couleurs personnalis√©es pour les m√©thodes HTTP */
        .method-get { @apply bg-emerald-500; }
        .method-post { @apply bg-blue-500; }
        .method-put { @apply bg-orange-500; }
        .method-delete { @apply bg-red-500; }
        .method-websocket { @apply bg-purple-500; }
        .method-other { @apply bg-gray-500; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800" x-data="talasApp()" x-init="init()" x-cloak>
    <!-- Navigation principale -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center gap-4">
                    <h1 class="text-3xl font-extrabold tracking-tight bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        üé∂ Talas
                    </h1>
                </div>

                <!-- Menu principal (affich√© seulement si connect√©) -->
                <div x-show="isAuthenticated" class="flex items-center gap-6">
                    <!-- Navigation -->
                    <div class="flex gap-2">
                        <button 
                            @click="setActiveView('dashboard')" 
                            :class="activeView === 'dashboard' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                            class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                        >
                            üè† Accueil
                        </button>
                        <button 
                            @click="setActiveView('tracks')" 
                            :class="activeView === 'tracks' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                            class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                        >
                            üéµ Pistes
                        </button>
                        <button 
                            @click="setActiveView('resources')" 
                            :class="activeView === 'resources' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                            class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                        >
                            üìÅ Ressources
                        </button>
                        <button 
                            @click="setActiveView('chat')" 
                            :class="activeView === 'chat' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                            class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                        >
                            üí¨ Chat
                        </button>
                        <button 
                            @click="setActiveView('search')" 
                            :class="activeView === 'search' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                            class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                        >
                            üîç Recherche
                        </button>
                        <button 
                            @click="setActiveView('docs')" 
                            :class="activeView === 'docs' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                            class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                        >
                            üìö API
                        </button>
                    </div>

                    <!-- Profil utilisateur -->
                    <div class="flex items-center gap-4">
                        <span class="text-sm text-gray-600">üë§ <span x-text="user.username"></span></span>
                        <button @click="logout()" class="text-sm text-red-600 hover:underline">D√©connexion</button>
                    </div>
                </div>

                <!-- Boutons d'authentification (affich√©s seulement si non connect√©) -->
                <div x-show="!isAuthenticated" class="flex items-center gap-4">
                    <button 
                        @click="setActiveView('login')" 
                        :class="activeView === 'login' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                        class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                    >
                        üîê Connexion
                    </button>
                    <button 
                        @click="setActiveView('register')" 
                        :class="activeView === 'register' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                        class="px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                    >
                        üìù Inscription
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="min-h-screen">
        <!-- Vue Connexion -->
        <div x-show="activeView === 'login'" x-transition class="min-h-screen flex items-center justify-center p-6">
            <div class="max-w-md w-full space-y-8">
                <!-- Header -->
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-900">Connexion</h2>
                    <p class="mt-2 text-sm text-gray-600">
                        Acc√©dez √† votre espace musical
                    </p>
                </div>

                <!-- Formulaire de connexion -->
                <div class="bg-white rounded-lg shadow-lg p-8 space-y-6">
                    <form @submit.prevent="login()" class="space-y-4">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
                                Email
                            </label>
                            <input 
                                type="email" 
                                id="email"
                                x-model="loginForm.email" 
                                placeholder="votre@email.com" 
                                required 
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                :disabled="loginForm.loading"
                            />
                        </div>

                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">
                                Mot de passe
                            </label>
                            <input 
                                type="password" 
                                id="password"
                                x-model="loginForm.password" 
                                placeholder="Votre mot de passe" 
                                required 
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                :disabled="loginForm.loading"
                            />
                        </div>

                        <button 
                            type="submit" 
                            :disabled="loginForm.loading || !loginForm.email || !loginForm.password"
                            class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"
                        >
                            <span x-show="!loginForm.loading">üîê Se connecter</span>
                            <span x-show="loginForm.loading" class="flex items-center gap-2">
                                <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Connexion...
                            </span>
                        </button>
                    </form>

                    <!-- Message d'√©tat -->
                    <div x-show="loginForm.message" x-transition class="text-center">
                        <p :class="loginForm.messageType === 'success' ? 'text-green-600' : 'text-red-600'" x-text="loginForm.message"></p>
                    </div>
                </div>

                <!-- Lien vers inscription -->
                <div class="text-center space-y-2">
                    <p class="text-sm text-gray-600">
                        Pas encore de compte ?
                        <button @click="setActiveView('register')" class="text-blue-600 hover:text-blue-700 font-medium hover:underline">
                            Cr√©er un compte
                        </button>
                    </p>
                </div>
            </div>
        </div>

        <!-- Vue Inscription -->
        <div x-show="activeView === 'register'" x-transition class="min-h-screen flex items-center justify-center p-6">
            <div class="max-w-md w-full space-y-8">
                <!-- Header -->
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-900">Cr√©er un compte</h2>
                    <p class="mt-2 text-sm text-gray-600">
                        Rejoignez la communaut√© musicale Talas
                    </p>
                </div>

                <!-- Formulaire d'inscription -->
                <div class="bg-white rounded-lg shadow-lg p-8 space-y-6">
                    <form @submit.prevent="register()" class="space-y-4">
                        <!-- Email -->
                        <div>
                            <label for="regEmail" class="block text-sm font-medium text-gray-700 mb-1">
                                Adresse email
                            </label>
                            <input 
                                type="email" 
                                id="regEmail"
                                x-model="registerForm.email" 
                                placeholder="votre@email.com" 
                                required 
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                :disabled="registerForm.loading"
                            />
                        </div>

                        <!-- Nom d'utilisateur -->
                        <div>
                            <label for="regUsername" class="block text-sm font-medium text-gray-700 mb-1">
                                Nom d'utilisateur
                            </label>
                            <input 
                                type="text" 
                                id="regUsername"
                                x-model="registerForm.username" 
                                placeholder="john_doe" 
                                required 
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                :disabled="registerForm.loading"
                                maxlength="30"
                            />
                        </div>

                        <!-- Mot de passe -->
                        <div>
                            <label for="regPassword" class="block text-sm font-medium text-gray-700 mb-1">
                                Mot de passe
                            </label>
                            <input 
                                type="password" 
                                id="regPassword"
                                x-model="registerForm.password" 
                                placeholder="Minimum 8 caract√®res" 
                                required 
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                :disabled="registerForm.loading"
                                minlength="8"
                            />
                        </div>

                        <!-- Confirmation mot de passe -->
                        <div>
                            <label for="regConfirmPassword" class="block text-sm font-medium text-gray-700 mb-1">
                                Confirmer le mot de passe
                            </label>
                            <input 
                                type="password" 
                                id="regConfirmPassword"
                                x-model="registerForm.confirmPassword" 
                                placeholder="Retapez votre mot de passe" 
                                required 
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                :disabled="registerForm.loading"
                            />
                        </div>

                        <!-- Conditions d'utilisation -->
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input 
                                    id="terms" 
                                    type="checkbox" 
                                    x-model="registerForm.acceptTerms"
                                    required
                                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                                    :disabled="registerForm.loading"
                                >
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="terms" class="text-gray-700">
                                    J'accepte les conditions d'utilisation et la politique de confidentialit√©
                                </label>
                            </div>
                        </div>

                        <button 
                            type="submit" 
                            :disabled="!isRegisterFormValid || registerForm.loading"
                            class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 font-medium"
                        >
                            <span x-show="!registerForm.loading">üìù Cr√©er mon compte</span>
                            <span x-show="registerForm.loading" class="flex items-center gap-2">
                                <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Cr√©ation du compte...
                            </span>
                        </button>
                    </form>

                    <!-- Message de statut -->
                    <div x-show="registerForm.message" x-transition class="text-center">
                        <p :class="registerForm.messageType === 'success' ? 'text-green-600' : 'text-red-600'" x-text="registerForm.message"></p>
                    </div>
                </div>

                <!-- Lien vers connexion -->
                <div class="text-center space-y-2">
                    <p class="text-sm text-gray-600">
                        Vous avez d√©j√† un compte ?
                        <button @click="setActiveView('login')" class="text-blue-600 hover:text-blue-700 font-medium hover:underline">
                            Se connecter
                        </button>
                    </p>
                </div>
            </div>
        </div>

        <!-- Vue Dashboard (accueil) -->
        <div x-show="activeView === 'dashboard' && isAuthenticated" x-transition class="max-w-7xl mx-auto p-6 space-y-8">
            <!-- Header de bienvenue -->
            <header class="bg-white rounded-lg shadow p-6">
                <div class="text-center">
                    <h1 class="text-4xl font-extrabold tracking-tight bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                        Bienvenue sur Talas, <span x-text="user.username"></span> ! üé∂
                    </h1>
                    <p class="text-xl text-gray-600">
                        Votre plateforme musicale compl√®te
                    </p>
                </div>
            </header>

            <!-- Statistiques globales -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-3xl font-bold text-blue-600" x-text="dashboardStats.totalTracks"></div>
                    <div class="text-sm text-gray-600">Pistes totales</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-3xl font-bold text-green-600" x-text="dashboardStats.totalResources"></div>
                    <div class="text-sm text-gray-600">Ressources partag√©es</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-3xl font-bold text-purple-600" x-text="dashboardStats.onlineUsers"></div>
                    <div class="text-sm text-gray-600">Utilisateurs en ligne</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-3xl font-bold text-orange-600" x-text="dashboardStats.chatRooms"></div>
                    <div class="text-sm text-gray-600">Salons de discussion</div>
                </div>
            </div>

            <!-- Actions rapides -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-xl font-semibold mb-4">üéµ Pistes musicales</h3>
                    <p class="text-gray-600 mb-4">Explorez et uploadez des pistes musicales</p>
                    <button @click="setActiveView('tracks')" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Acc√©der aux pistes
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-xl font-semibold mb-4">üìÅ Ressources</h3>
                    <p class="text-gray-600 mb-4">Partagez et t√©l√©chargez des ressources</p>
                    <button @click="setActiveView('resources')" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        Voir les ressources
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-xl font-semibold mb-4">üí¨ Chat</h3>
                    <p class="text-gray-600 mb-4">Discutez avec la communaut√©</p>
                    <button @click="setActiveView('chat')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                        Rejoindre le chat
                    </button>
                </div>
            </div>
        </div>

        <!-- Vue Pistes -->
        <div x-show="activeView === 'tracks' && isAuthenticated" x-transition>
            <div id="tracks-content">
                <!-- Le contenu des pistes sera charg√© ici -->
                <div class="max-w-6xl mx-auto p-6">
                    <div class="text-center py-12">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">üéµ Section Pistes</h2>
                        <p class="text-gray-600">G√©rez vos morceaux, partagez vos cr√©ations et explorez les morceaux publics de la communaut√© Talas.</p>
                        <a href="/track" class="text-indigo-500 hover:underline mt-2 inline-block">G√©rer mes morceaux</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vue Ressources -->
        <div x-show="activeView === 'resources' && isAuthenticated" x-transition>
            <div id="resources-content">
                <!-- Le contenu des ressources sera charg√© ici -->
                <div class="max-w-6xl mx-auto p-6">
                    <div class="text-center py-12">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">üìÅ Section Ressources</h2>
                        <p class="text-gray-600">Acc√©dez √† vos produits enregistr√©s, leurs documents techniques, garanties, fichiers manuels et ressources internes.</p>
                        <a href="/shared_ressources" class="text-indigo-500 hover:underline mt-2 inline-block">Voir mes produits</a>

                    </div>
                </div>
            </div>
        </div>

        <!-- Vue Chat -->
        <div x-show="activeView === 'chat' && isAuthenticated" x-transition>
            <div id="chat-content">
                <!-- Le contenu du chat sera charg√© ici -->
                <div class="max-w-6xl mx-auto p-6">
                    <div class="text-center py-12">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">üí¨ Section Chat</h2>
                        <p class="text-gray-600">Rejoignez des salons publics ou discutez en priv√© avec d'autres artistes.</p>
                        <a href="/chat" class="text-indigo-500 hover:underline mt-2 inline-block">Acc√©der au chat</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vue Recherche -->
        <div x-show="activeView === 'search' && isAuthenticated" x-transition class="max-w-6xl mx-auto p-6 space-y-8">
            <header class="bg-white rounded-lg shadow p-6">
                <h1 class="text-4xl font-extrabold tracking-tight bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                    üîç Recherche Globale
                </h1>
                <p class="text-gray-600">Recherchez dans tous vos fichiers, messages, produits, morceaux et ressources partag√©es.</p>
                <a href="/search" class="text-indigo-500 hover:underline mt-2 inline-block">Faire une recherche</a>
            </header>

            <!-- Barre de recherche -->
            <div class="bg-white rounded-lg shadow p-6">
                <input
                    type="text"
                    placeholder="Tapez votre recherche ici..."
                    class="w-full p-4 text-lg rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    x-model="searchQuery"
                    @input.debounce.400ms="performGlobalSearch()"
                />
            </div>

            <!-- Indicateur de chargement -->
            <div x-show="searchLoading" class="text-center py-8">
                <div class="inline-flex items-center gap-2 text-blue-600">
                    <svg class="animate-spin h-6 w-6" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Recherche en cours...
                </div>
            </div>

            <!-- Erreur de recherche -->
            <div x-show="searchError" class="bg-red-50 border border-red-200 rounded-lg p-4">
                <p class="text-red-600" x-text="searchError"></p>
            </div>

            <!-- R√©sultats de recherche -->
            <div x-show="!searchLoading && searchResults && searchQuery" class="space-y-6">
                <!-- Utilisateurs -->
                <div x-show="searchResults.users && searchResults.users.length > 0" class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">üë§ Utilisateurs</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="user in searchResults.users" :key="user.id">
                            <div class="border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                <h3 class="font-semibold" x-text="user.username"></h3>
                                <p class="text-sm text-gray-600" x-text="user.email"></p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Pistes -->
                <div x-show="searchResults.tracks && searchResults.tracks.length > 0" class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">üéµ Pistes musicales</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="track in searchResults.tracks" :key="track.id">
                            <div class="border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                <h3 class="font-semibold" x-text="track.title"></h3>
                                <p class="text-sm text-gray-600" x-text="'par ' + track.artist"></p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Ressources partag√©es -->
                <div x-show="searchResults.shared_resources && searchResults.shared_resources.length > 0" class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">üìÅ Ressources partag√©es</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="resource in searchResults.shared_resources" :key="resource.id">
                            <div class="border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                <h3 class="font-semibold" x-text="resource.title"></h3>
                                <p x-show="resource.description" class="text-sm text-gray-600" x-text="resource.description"></p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Aucun r√©sultat -->
                <div x-show="searchResults && Object.values(searchResults).every(arr => arr.length === 0)" class="bg-gray-50 rounded-lg p-8 text-center">
                    <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Aucun r√©sultat trouv√©</h3>
                    <p class="text-gray-500">Essayez avec d'autres mots-cl√©s</p>
                </div>
            </div>
        </div>

        <!-- Vue Documentation API -->
        <div x-show="activeView === 'docs' && isAuthenticated" x-transition>
            <div class="max-w-7xl mx-auto p-6 space-y-8">
                <!-- Header -->
                <header class="gradient-bg text-white shadow-xl">
                    <div class="max-w-7xl mx-auto px-6 py-12">
                        <div class="text-center">
                            <h1 class="text-5xl font-extrabold mb-4 tracking-tight">
                                üìö Documentation API Talas
                            </h1>
                            <p class="text-xl opacity-90 mb-8">
                                Guide complet des endpoints et fonctionnalit√©s de l'API Talas
                            </p>
                            
                            <!-- Statistiques rapides -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-2xl mx-auto">
                                <div class="bg-white/20 backdrop-blur rounded-lg p-4">
                                    <div class="text-2xl font-bold" x-text="apiStats.totalEndpoints"></div>
                                    <div class="text-sm opacity-80">Endpoints</div>
                                </div>
                                <div class="bg-white/20 backdrop-blur rounded-lg p-4">
                                    <div class="text-2xl font-bold" x-text="apiStats.totalSectors"></div>
                                    <div class="text-sm opacity-80">Secteurs</div>
                                </div>
                                <div class="bg-white/20 backdrop-blur rounded-lg p-4">
                                    <div class="text-2xl font-bold" x-text="apiStats.websocketEndpoints"></div>
                                    <div class="text-sm opacity-80">WebSockets</div>
                                </div>
                                <div class="bg-white/20 backdrop-blur rounded-lg p-4">
                                    <div class="text-2xl font-bold" x-text="apiStats.authEndpoints"></div>
                                    <div class="text-sm opacity-80">Auth</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Navigation & Filtres API -->
                <nav class="bg-white shadow-lg p-4">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <!-- Recherche -->
                        <div class="flex-1 max-w-md">
                            <div class="relative">
                                <input 
                                    x-model="apiSearchQuery"
                                    @input="filterApiRoutes()"
                                    type="text" 
                                    placeholder="Rechercher un endpoint..." 
                                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>

                        <!-- Filtres par m√©thode -->
                        <div class="flex flex-wrap gap-2">
                            <template x-for="method in availableMethods" :key="method">
                                <button 
                                    @click="toggleMethodFilter(method)"
                                    :class="methodFilters.includes(method) ? `method-${method.toLowerCase()} text-white` : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
                                    class="px-3 py-1 text-xs font-bold rounded-full uppercase transition-colors"
                                    x-text="method"
                                ></button>
                            </template>
                            <button 
                                @click="clearApiFilters()"
                                class="px-3 py-1 text-xs font-medium text-red-600 bg-red-100 hover:bg-red-200 rounded-full transition-colors"
                            >
                                Effacer
                            </button>
                        </div>

                        <!-- Actions -->
                        <div class="flex gap-2">
                            <button 
                                @click="expandAllSectors()"
                                class="px-4 py-2 text-sm font-medium text-blue-600 bg-blue-100 hover:bg-blue-200 rounded-lg transition-colors"
                            >
                                Tout ouvrir
                            </button>
                            <button 
                                @click="collapseAllSectors()"
                                class="px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                            >
                                Tout fermer
                            </button>
                        </div>
                    </div>
                </nav>

                <!-- R√©sultats de recherche API -->
                <div x-show="apiSearchQuery || methodFilters.length > 0" class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-blue-800">
                        <span x-text="filteredApiCount"></span> endpoint(s) trouv√©(s)
                        <template x-if="apiSearchQuery">
                            <span>pour "<span class="font-semibold" x-text="apiSearchQuery"></span>"</span>
                        </template>
                        <template x-if="methodFilters.length > 0">
                            <span>avec les m√©thodes: <span class="font-semibold" x-text="methodFilters.join(', ')"></span></span>
                        </template>
                    </p>
                </div>

                <!-- Secteurs d'API -->
                <div class="space-y-8">
                    <template x-for="(sector, sectorName) in filteredApiSectors" :key="sectorName">
                        <section class="bg-white shadow-xl rounded-xl overflow-hidden border border-gray-200">
                            <!-- En-t√™te du secteur -->
                            <header class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-2xl font-bold text-gray-800" x-text="sectorName"></h2>
                                    <div class="flex items-center gap-4">
                                        <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full">
                                            <span x-text="sector.length"></span> endpoint(s)
                                        </span>
                                        <button 
                                            @click="toggleSector(sectorName)"
                                            class="text-gray-500 hover:text-gray-700 transition-colors"
                                        >
                                            <svg 
                                                class="w-6 h-6 transition-transform duration-200"
                                                :class="{ 'rotate-180': sectorExpanded[sectorName] }"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                            >
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <!-- Contenu du secteur -->
                            <div x-show="sectorExpanded[sectorName]" x-cloak class="divide-y divide-gray-100">
                                <template x-for="(route, index) in sector" :key="index">
                                    <article class="hover:bg-gray-50 transition-colors">
                                        <!-- En-t√™te de l'endpoint -->
                                        <button
                                            @click="toggleDescription(sectorName, index)"
                                            class="w-full text-left p-6 flex items-center justify-between group"
                                        >
                                            <div class="flex items-center space-x-4 flex-1">
                                                <!-- Badge m√©thode HTTP -->
                                                <span
                                                    class="px-3 py-1 text-xs font-bold text-white rounded-md uppercase shadow-sm"
                                                    :class="`method-${route.method.toLowerCase()}`"
                                                    x-text="route.method"
                                                ></span>
                                                
                                                <!-- Path -->
                                                <code class="font-mono text-sm bg-gray-100 px-3 py-1 rounded text-gray-800 group-hover:bg-gray-200 transition-colors" x-text="route.path"></code>
                                                
                                                <!-- Titre court -->
                                                <span class="text-gray-600 text-sm" x-text="route.shortDescription || route.description.split('.')[0] + '.'"></span>
                                            </div>
                                            
                                            <!-- Indicateurs -->
                                            <div class="flex items-center gap-2">
                                                <template x-if="route.auth">
                                                    <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">üîê Auth</span>
                                                </template>
                                                <template x-if="route.new">
                                                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">‚ú® Nouveau</span>
                                                </template>
                                                <svg
                                                    class="h-5 w-5 text-gray-400 transition-transform duration-200 group-hover:text-gray-600"
                                                    :class="{ 'rotate-90': route.showDescription }"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                                >
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                                </svg>
                                            </div>
                                        </button>

                                        <!-- D√©tails de l'endpoint -->
                                        <div x-show="route.showDescription" x-cloak class="px-6 pb-6 fade-in">
                                            <div class="bg-gray-50 rounded-lg p-6 space-y-6">
                                                <!-- Description -->
                                                <div>
                                                    <h4 class="text-lg font-semibold text-gray-800 mb-2">Description</h4>
                                                    <p class="text-gray-700 leading-relaxed" x-html="formatDescription(route.description)"></p>
                                                </div>

                                                <!-- Notes -->
                                                <div x-show="route.notes">
                                                    <h4 class="text-lg font-semibold text-gray-800 mb-2">üìù Notes techniques</h4>
                                                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                                                        <p class="text-blue-800" x-html="formatDescription(route.notes)"></p>
                                                    </div>
                                                </div>

                                                <!-- Exemple de requ√™te -->
                                                <div x-show="route.example">
                                                    <h4 class="text-lg font-semibold text-gray-800 mb-2">üíª Exemple</h4>
                                                    <div class="code-block">
                                                        <pre x-text="route.example"></pre>
                                                    </div>
                                                </div>

                                                <!-- Param√®tres -->
                                                <div x-show="route.parameters && route.parameters.length > 0">
                                                    <h4 class="text-lg font-semibold text-gray-800 mb-2">‚öôÔ∏è Param√®tres</h4>
                                                    <div class="overflow-x-auto">
                                                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                                                            <thead class="bg-gray-100">
                                                                <tr>
                                                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Nom</th>
                                                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Type</th>
                                                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Requis</th>
                                                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Description</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody class="divide-y divide-gray-200">
                                                                <template x-for="param in route.parameters" :key="param.name">
                                                                    <tr>
                                                                        <td class="px-4 py-2 font-mono text-sm" x-text="param.name"></td>
                                                                        <td class="px-4 py-2 text-sm">
                                                                            <span class="px-2 py-1 bg-gray-100 rounded text-gray-700" x-text="param.type"></span>
                                                                        </td>
                                                                        <td class="px-4 py-2 text-sm">
                                                                            <span :class="param.required ? 'text-red-600' : 'text-gray-500'" x-text="param.required ? 'Oui' : 'Non'"></span>
                                                                        </td>
                                                                        <td class="px-4 py-2 text-sm text-gray-700" x-text="param.description"></td>
                                                                    </tr>
                                                                </template>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <!-- Actions rapides -->
                                                <div class="flex flex-wrap gap-3 pt-4 border-t border-gray-200">
                                                    <button 
                                                        @click="copyToClipboard(route.path)"
                                                        class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"
                                                    >
                                                        üìã Copier l'URL
                                                    </button>
                                                    <template x-if="route.testable">
                                                        <button class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                                                            üß™ Tester
                                                        </button>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </article>
                                </template>
                            </div>
                        </section>
                    </template>
                </div>

                <!-- Message si aucun r√©sultat API -->
                <div x-show="Object.keys(filteredApiSectors).length === 0" class="text-center py-12">
                    <div class="max-w-md mx-auto">
                        <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 20.4a7.962 7.962 0 01-5-1.691c-2.982-1.814-3.982-4.481-3.982-6.109V8.586A2 2 0 014.414 7l4.293-4.293A1 1 0 0110 2.5h4a1 1 0 01.707.293L19 7.086A2 2 0 0120.414 8.6v3.995c0 1.628-1 4.295-3.982 6.109z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Aucun endpoint trouv√©</h3>
                        <p class="text-gray-500">Essayez de modifier vos crit√®res de recherche ou de filtrage.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notifications globales -->
    <div class="fixed bottom-4 right-4 space-y-2 z-50">
        <template x-for="notification in notifications" :key="notification.id">
            <div 
                x-show="notification.show"
                x-transition
                :class="notification.type === 'success' ? 'bg-green-500' : notification.type === 'info' ? 'bg-blue-500' : 'bg-red-500'"
                class="text-white px-6 py-3 rounded-lg shadow-lg max-w-sm"
            >
                <span x-text="notification.message"></span>
            </div>
        </template>
    </div>

    <!-- Script principal -->
    <script>
        function talasApp() {
            return {
                // √âtat principal
                activeView: 'dashboard',
                isAuthenticated: false,
                user: {
                    username: '',
                    email: '',
                    id: null
                },
                
                // Formulaires
                loginForm: {
                    email: '',
                    password: '',
                    loading: false,
                    message: '',
                    messageType: 'error'
                },
                
                registerForm: {
                    email: '',
                    username: '',
                    password: '',
                    confirmPassword: '',
                    acceptTerms: false,
                    loading: false,
                    message: '',
                    messageType: 'error'
                },
                
                // Recherche globale
                searchQuery: '',
                searchResults: null,
                searchLoading: false,
                searchError: '',
                
                // Documentation API
                apiSearchQuery: '',
                methodFilters: [],
                availableMethods: ['GET', 'POST', 'PUT', 'DELETE', 'WEBSOCKET'],
                sectorExpanded: {},
                filteredApiSectors: {},
                filteredApiCount: 0,
                
                // Statistiques
                dashboardStats: {
                    totalTracks: 0,
                    totalResources: 0,
                    onlineUsers: 0,
                    chatRooms: 0
                },
                
                apiStats: {
                    totalEndpoints: 0,
                    totalSectors: 0,
                    websocketEndpoints: 0,
                    authEndpoints: 0
                },
                
                // Notifications
                notifications: [],
                
                // Donn√©es API (simul√©es pour l'exemple)
                apiSectors: {
                    "üîê Authentification & Utilisateurs": [
                        { 
                            method: "POST", 
                            path: "/signup", 
                            description: "Inscrit un **nouvel utilisateur** sur la plateforme Talas. Cette route cr√©e un compte unique avec un nom d'utilisateur, une adresse email et un mot de passe.", 
                            notes: "Requiert un corps JSON avec les champs obligatoires : `username`, `email`, et `password`. En cas de succ√®s, elle retourne des tokens d'acc√®s pour l'authentification future.",
                            auth: false,
                            new: false,
                            showDescription: false,
                            parameters: [
                                { name: "username", type: "string", required: true, description: "Nom d'utilisateur unique" },
                                { name: "email", type: "string", required: true, description: "Adresse email valide" },
                                { name: "password", type: "string", required: true, description: "Mot de passe (min 8 caract√®res)" }
                            ],
                            example: `curl -X POST "http://localhost:8080/signup" \\
  -H "Content-Type: application/json" \\
  -d '{
    "username": "john_doe",
    "email": "john@example.com",
    "password": "motdepasse123"
  }'`,
                            testable: true
                        },
                        { 
                            method: "POST", 
                            path: "/login", 
                            description: "Authentifie un utilisateur existant. Cette route v√©rifie les identifiants fournis et, si valides, √©met des tokens de session.", 
                            notes: "Requiert un corps JSON avec les champs `email` et `password`. Retourne un `access_token` et un `refresh_token` n√©cessaires pour les requ√™tes authentifi√©es.",
                            auth: false,
                            showDescription: false,
                            parameters: [
                                { name: "email", type: "string", required: true, description: "Adresse email du compte" },
                                { name: "password", type: "string", required: true, description: "Mot de passe du compte" }
                            ],
                            example: `curl -X POST "http://localhost:8080/login" \\
  -H "Content-Type: application/json" \\
  -d '{
    "email": "john@example.com",
    "password": "motdepasse123"
  }'`,
                            testable: true
                        }
                    ],
                    "üéµ Pistes Musicales": [
                        { 
                            method: "GET", 
                            path: "/tracks/all", 
                            description: "R√©cup√®re une liste compl√®te de toutes les pistes musicales disponibles sur la plateforme.", 
                            notes: "Cet endpoint est fr√©quemment appel√© par des interfaces utilisateur pour peupler les listes de lecture.",
                            showDescription: false
                        },
                        { 
                            method: "POST", 
                            path: "/tracks", 
                            description: "Permet √† un utilisateur de t√©l√©verser une nouvelle piste musicale.", 
                            notes: "Requiert un formulaire multipart (`multipart/form-data`) avec les champs `title`, `artist`, `tags` et `audio`.",
                            auth: true,
                            showDescription: false,
                            parameters: [
                                { name: "title", type: "string", required: true, description: "Titre de la piste" },
                                { name: "artist", type: "string", required: true, description: "Nom de l'artiste" },
                                { name: "tags", type: "string", required: false, description: "Tags s√©par√©s par des virgules" },
                                { name: "audio", type: "file", required: true, description: "Fichier audio (MP3, WAV, FLAC)" }
                            ]
                        }
                    ],
                    "üí¨ Chat & WebSockets": [
                        { 
                            method: "WEBSOCKET", 
                            path: "ws://localhost:9001/?token={token}", 
                            description: "√âtablit une connexion WebSocket pour les messages directs (DM) et les salons de discussion.", 
                            notes: "N√©cessite un token JWT valide pass√© comme param√®tre de requ√™te `token`.",
                            auth: true,
                            showDescription: false,
                            parameters: [
                                { name: "token", type: "string", required: true, description: "Token JWT d'authentification" }
                            ],
                            example: `// Connexion WebSocket
const token = localStorage.getItem('access_token');
const socket = new WebSocket(\`ws://localhost:9001/?token=\${token}\`);

// Envoyer un message priv√©
socket.send(JSON.stringify({
    type: "dm",
    to: 123,
    content: "Hello!"
}));`
                        }
                    ]
                },

                // Initialisation
                messages: [],
                async init() {
                    try {
                        const res = await fetch('/search?q=test');

                        const contentType = res.headers.get("Content-Type");
                        const text = await res.text();

                        if (!res.ok) {
                            console.error("Erreur HTTP", res.status, text);
                            return;
                        }

                        if (!contentType || !contentType.includes("application/json")) {
                            console.error("R√©ponse non-JSON d√©tect√©e : ", text);
                            return;
                        }

                        const data = JSON.parse(text);
                        this.messages = data.messages || [];
                    } catch (e) {
                        console.error("Erreur fetch/init:", e);
                    }
                },

                // Gestion de l'authentification
                checkExistingAuth() {
                    const token = localStorage.getItem('access_token');
                    if (token) {
                        try {
                            const payload = JSON.parse(atob(token.split('.')[1]));
                            if (!payload.exp || payload.exp > Date.now() / 1000) {
                                this.isAuthenticated = true;
                                this.user.username = payload.username || 'Utilisateur';
                                this.user.email = payload.email || '';
                                this.user.id = payload.user_id || payload.id || payload.sub;
                                this.activeView = 'dashboard';
                            } else {
                                localStorage.removeItem('access_token');
                                localStorage.removeItem('refresh_token');
                                this.activeView = 'login';
                            }
                        } catch (e) {
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('refresh_token');
                            this.activeView = 'login';
                        }
                    } else {
                        this.activeView = 'login';
                    }
                },

                async login() {
                    if (this.loginForm.loading) return;
                    
                    this.loginForm.loading = true;
                    this.loginForm.message = '';

                    try {
                        const response = await fetch('/login', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json' 
                            },
                            body: JSON.stringify({ 
                                email: this.loginForm.email, 
                                password: this.loginForm.password 
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            
                            localStorage.setItem('access_token', data.access_token);
                            if (data.refresh_token) {
                                localStorage.setItem('refresh_token', data.refresh_token);
                            }

                            try {
                                const payload = JSON.parse(atob(data.access_token.split('.')[1]));
                                this.user.username = payload.username || payload.email || 'Utilisateur';
                                this.user.email = payload.email || '';
                                this.user.id = payload.user_id || payload.id || payload.sub;
                            } catch (e) {
                                this.user.username = 'Utilisateur';
                            }

                            this.isAuthenticated = true;
                            this.loginForm.message = `Connexion r√©ussie ! Bienvenue ${this.user.username}`;
                            this.loginForm.messageType = 'success';

                            setTimeout(() => {
                                this.setActiveView('dashboard');
                                this.resetLoginForm();
                            }, 1000);

                        } else {
                            this.loginForm.message = 'Identifiants incorrects ou compte non activ√©';
                            this.loginForm.messageType = 'error';
                        }
                    } catch (error) {
                        this.loginForm.message = 'Erreur de connexion au serveur';
                        this.loginForm.messageType = 'error';
                    } finally {
                        this.loginForm.loading = false;
                    }
                },

                async register() {
                    if (!this.isRegisterFormValid || this.registerForm.loading) return;
                    
                    this.registerForm.loading = true;
                    this.registerForm.message = '';

                    try {
                        const response = await fetch('/signup', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json' 
                            },
                            body: JSON.stringify({
                                email: this.registerForm.email,
                                username: this.registerForm.username,
                                password: this.registerForm.password
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            
                            localStorage.setItem('access_token', data.access_token);
                            if (data.refresh_token) {
                                localStorage.setItem('refresh_token', data.refresh_token);
                            }

                            this.user.username = this.registerForm.username;
                            this.user.email = this.registerForm.email;
                            this.isAuthenticated = true;
                            
                            this.registerForm.message = `Bienvenue ${this.registerForm.username} ! Votre compte a √©t√© cr√©√© avec succ√®s.`;
                            this.registerForm.messageType = 'success';

                            setTimeout(() => {
                                this.setActiveView('dashboard');
                                this.resetRegisterForm();
                            }, 2000);

                        } else {
                            let errorMessage = 'Erreur lors de la cr√©ation du compte';
                            
                            if (response.status === 409) {
                                errorMessage = 'Cet email ou nom d\'utilisateur est d√©j√† utilis√©';
                            } else if (response.status === 400) {
                                errorMessage = 'Donn√©es invalides. V√©rifiez vos informations.';
                            }
                            
                            this.registerForm.message = errorMessage;
                            this.registerForm.messageType = 'error';
                        }
                    } catch (error) {
                        this.registerForm.message = 'Erreur de connexion au serveur';
                        this.registerForm.messageType = 'error';
                    } finally {
                        this.registerForm.loading = false;
                    }
                },

                logout() {
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token');
                    this.isAuthenticated = false;
                    this.user = { username: '', email: '', id: null };
                    this.activeView = 'login';
                    this.showNotification('D√©connexion r√©ussie', 'info');
                },

                // Navigation
                setActiveView(view) {
                    this.activeView = view;
                    
                    // R√©initialiser les messages d'erreur
                    this.loginForm.message = '';
                    this.registerForm.message = '';
                    
                    // Charger les donn√©es sp√©cifiques √† la vue
                    if (view === 'docs') {
                        this.initializeApiData();
                    } else if (view === 'dashboard') {
                        this.loadDashboardStats();
                    }
                },

                // Utilitaires pour les formulaires
                resetLoginForm() {
                    this.loginForm = {
                        email: '',
                        password: '',
                        loading: false,
                        message: '',
                        messageType: 'error'
                    };
                },

                resetRegisterForm() {
                    this.registerForm = {
                        email: '',
                        username: '',
                        password: '',
                        confirmPassword: '',
                        acceptTerms: false,
                        loading: false,
                        message: '',
                        messageType: 'error'
                    };
                },

                // Validation du formulaire d'inscription
                get isRegisterFormValid() {
                    return (
                        this.registerForm.email &&
                        this.registerForm.username &&
                        this.registerForm.username.length >= 3 &&
                        this.registerForm.password &&
                        this.registerForm.password.length >= 8 &&
                        this.registerForm.confirmPassword &&
                        this.registerForm.password === this.registerForm.confirmPassword &&
                        this.registerForm.acceptTerms
                    );
                },

                // Recherche globale
                async performGlobalSearch() {
                    if (!this.searchQuery.trim()) {
                        this.searchResults = null;
                        this.searchError = '';
                        return;
                    }
                    
                    this.searchLoading = true;
                    this.searchError = '';
                    
                    try {
                        const token = localStorage.getItem('access_token');
                        const response = await fetch(`/search?q=${encodeURIComponent(this.searchQuery)}`, {
                            headers: {
                                'Authorization': 'Bearer ' + token
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error('Erreur serveur');
                        }
                        
                        this.searchResults = await response.json();
                    } catch (error) {
                        this.searchError = 'Impossible de charger les r√©sultats.';
                        this.searchResults = {
                            users: [],
                            tracks: [],
                            shared_resources: []
                        };
                    } finally {
                        this.searchLoading = false;
                    }
                },

                // Chargement des statistiques du dashboard
                async loadDashboardStats() {
                    try {
                        const token = localStorage.getItem('access_token');
                        
                        // Simulation des statistiques (remplacer par de vrais appels API)
                        this.dashboardStats = {
                            totalTracks: Math.floor(Math.random() * 1000) + 100,
                            totalResources: Math.floor(Math.random() * 500) + 50,
                            onlineUsers: Math.floor(Math.random() * 50) + 10,
                            chatRooms: Math.floor(Math.random() * 20) + 5
                        };
                    } catch (error) {
                        console.error('Erreur chargement stats dashboard:', error);
                    }
                },

                // Documentation API
                initializeApiData() {
                    // Initialiser l'√©tat d'expansion des secteurs
                    for (const sectorName in this.apiSectors) {
                        this.sectorExpanded[sectorName] = true;
                        
                        // Initialiser showDescription pour chaque route
                        this.apiSectors[sectorName].forEach(route => {
                            if (!route.hasOwnProperty('showDescription')) {
                                route.showDescription = false;
                            }
                        });
                    }
                    
                    // Calculer les statistiques API
                    this.calculateApiStats();
                    
                    // Initialiser les secteurs filtr√©s
                    this.filterApiRoutes();
                },

                calculateApiStats() {
                    let totalEndpoints = 0;
                    let websocketEndpoints = 0;
                    let authEndpoints = 0;

                    for (const sectorName in this.apiSectors) {
                        const routes = this.apiSectors[sectorName];
                        totalEndpoints += routes.length;
                        
                        routes.forEach(route => {
                            if (route.method === 'WEBSOCKET') {
                                websocketEndpoints++;
                            }
                            if (route.auth) {
                                authEndpoints++;
                            }
                        });
                    }

                    this.apiStats = {
                        totalEndpoints,
                        totalSectors: Object.keys(this.apiSectors).length,
                        websocketEndpoints,
                        authEndpoints
                    };
                },

                filterApiRoutes() {
                    this.filteredApiSectors = {};
                    this.filteredApiCount = 0;

                    for (const sectorName in this.apiSectors) {
                        const filteredRoutes = this.apiSectors[sectorName].filter(route => {
                            // Filtre par m√©thode
                            if (this.methodFilters.length > 0 && !this.methodFilters.includes(route.method)) {
                                return false;
                            }

                            // Filtre par recherche textuelle
                            if (this.apiSearchQuery) {
                                const query = this.apiSearchQuery.toLowerCase();
                                return (
                                    route.path.toLowerCase().includes(query) ||
                                    route.description.toLowerCase().includes(query) ||
                                    route.method.toLowerCase().includes(query) ||
                                    (route.notes && route.notes.toLowerCase().includes(query))
                                );
                            }

                            return true;
                        });

                        if (filteredRoutes.length > 0) {
                            this.filteredApiSectors[sectorName] = filteredRoutes;
                            this.filteredApiCount += filteredRoutes.length;
                        }
                    }
                },

                toggleMethodFilter(method) {
                    const index = this.methodFilters.indexOf(method);
                    if (index > -1) {
                        this.methodFilters.splice(index, 1);
                    } else {
                        this.methodFilters.push(method);
                    }
                    this.filterApiRoutes();
                },

                clearApiFilters() {
                    this.apiSearchQuery = '';
                    this.methodFilters = [];
                    this.filterApiRoutes();
                },

                toggleSector(sectorName) {
                    this.sectorExpanded[sectorName] = !this.sectorExpanded[sectorName];
                },

                expandAllSectors() {
                    for (const sectorName in this.filteredApiSectors) {
                        this.sectorExpanded[sectorName] = true;
                        this.filteredApiSectors[sectorName].forEach(route => {
                            route.showDescription = true;
                        });
                    }
                },

                collapseAllSectors() {
                    for (const sectorName in this.filteredApiSectors) {
                        this.sectorExpanded[sectorName] = false;
                        this.filteredApiSectors[sectorName].forEach(route => {
                            route.showDescription = false;
                        });
                    }
                },

                toggleDescription(sectorName, index) {
                    const route = this.filteredApiSectors[sectorName][index];
                    route.showDescription = !route.showDescription;
                },

                formatDescription(text) {
                    if (!text) return '';
                    
                    // Convertir le markdown basique en HTML
                    return text
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/`(.*?)`/g, '<code class="bg-gray-200 px-1 rounded">$1</code>')
                        .replace(/\n/g, '<br>');
                },

                async copyToClipboard(text) {
                    try {
                        await navigator.clipboard.writeText(text);
                        this.showNotification('URL copi√©e dans le presse-papier !', 'success');
                    } catch (err) {
                        console.error('Erreur lors de la copie:', err);
                        this.showNotification('Erreur lors de la copie', 'error');
                    }
                },

                // Syst√®me de notifications
                showNotification(message, type = 'success') {
                    const id = Date.now();
                    const notification = {
                        id,
                        message,
                        type,
                        show: true
                    };
                    this.notifications.push(notification);

                    setTimeout(() => {
                        const index = this.notifications.findIndex(n => n.id === id);
                        if (index > -1) {
                            this.notifications[index].show = false;
                            setTimeout(() => {
                                this.notifications = this.notifications.filter(n => n.id !== id);
                            }, 300);
                        }
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>